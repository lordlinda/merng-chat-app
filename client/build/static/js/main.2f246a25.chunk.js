/*! For license information please see main.2f246a25.chunk.js.LICENSE.txt */
(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{215:function(e,t,n){},216:function(e,t,n){},230:function(e,t,n){"use strict";n.r(t);var a=n(29),r=n(4),c=n(0),o=n(77),s=n.n(o),i=(n(215),n(216),n(42)),l=n(19),j=(n(217),n(25)),u=n(14),d=n(254),b=n(252),m=n(253),O=n(104),h=n(150),p=n(107),x=n.n(p),g=n(248);var v=function(e){var t=e.content,n=e.children;return Object(r.jsx)(g.a,{inverted:!0,content:t,trigger:n})},f=n(18),y=n(192),I={user:null};if(localStorage.getItem("jwtToken")){var C=Object(y.a)(localStorage.getItem("jwtToken"));1e3*C.exp<Date.now()?localStorage.removeItem("jwtToken"):I.user=C}var w=Object(c.createContext)({user:null,login:function(e){},logout:function(){}});function k(e,t){switch(t.type){case"LOGIN":return Object(a.a)(Object(a.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(a.a)(Object(a.a)({},e),{},{user:null});default:return e}}function P(e){var t=Object(c.useReducer)(k,I),n=Object(f.a)(t,2),o=n[0],s=n[1];return Object(r.jsx)(w.Provider,Object(a.a)({value:{user:o.user,login:function(e){localStorage.setItem("jwtToken",e.token),s({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),s({type:"LOGOUT"})}}},e))}function S(){var e=Object(j.a)(["\n  mutation likePost($postId: ID!) {\n    likePost(postId: $postId) {\n      _id\n      likes {\n        _id\n        username\n      }\n    }\n  }\n"]);return S=function(){return e},e}var $=Object(u.gql)(S()),_=function(e){var t=Object(c.useContext)(w).user,n=e.post,a=e.likeCount,o=e.likes,s=Object(c.useState)(!1),l=Object(f.a)(s,2),j=l[0],d=l[1];Object(c.useEffect)((function(){t&&o.find((function(e){return e.username===t.username}))?d(!0):d(!1)}),[t,o]);var b=Object(u.useMutation)($,{variables:{postId:n}}),p=Object(f.a)(b,1)[0],x=t?j?Object(r.jsx)(m.a,{color:"teal",children:Object(r.jsx)(O.a,{name:"heart"})}):Object(r.jsx)(m.a,{color:"teal",inverted:!0,children:Object(r.jsx)(O.a,{name:"heart"})}):Object(r.jsx)(m.a,{as:i.b,to:"/login",color:"teal",basic:!0,children:Object(r.jsx)(O.a,{name:"heart"})});return Object(r.jsxs)(m.a,{as:"div",labelPosition:"right",onClick:p,children:[Object(r.jsx)(v,{content:j?"Unlike":"Like",children:x}),Object(r.jsx)(h.a,{basic:!0,color:"teal",pointing:"left",children:a})]})},A=n(251);function q(){var e=Object(j.a)(["\n  {\n    getPosts {\n      _id\n      body\n      createdAt\n      username\n    }\n  }\n"]);return q=function(){return e},e}var D=Object(u.gql)(q());function M(){var e=Object(j.a)(["\n  mutation deleteComment($postId: ID!, $commentId: ID!) {\n    deleteComment(postId: $postId, commentId: $commentId) {\n      _id\n      comments {\n        _id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"]);return M=function(){return e},e}function N(){var e=Object(j.a)(["\n  mutation deletePost($postId: ID!) {\n    deletePost(postId: $postId)\n  }\n"]);return N=function(){return e},e}var R=Object(u.gql)(N()),E=Object(u.gql)(M()),L=function(e){var t=e.postId,n=e.commentId,a=e.callback,o=Object(c.useState)(!1),s=Object(f.a)(o,2),i=s[0],l=s[1],j=n?E:R,d=Object(u.useMutation)(j,{update:function(e){if(l(!1),!n){var r=e.readQuery({query:D});r.getPosts=r.getPosts.filter((function(e){return e.id!==t})),e.writeQuery({query:D,data:r})}a&&a()},variables:{postId:t,commentId:n}}),b=Object(f.a)(d,1)[0];return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(v,{content:n?"Delete comment":"Delete post",children:Object(r.jsx)(m.a,{as:"div",color:"red",floated:"right",onClick:function(){return l(!0)},children:Object(r.jsx)(O.a,{name:"trash",style:{margin:0}})})}),Object(r.jsx)(A.a,{open:i,onCancel:function(){return l(!1)},onConfirm:b})]})};var T=function(e){var t=e.post,n=t.body,a=t.createdAt,o=t.username,s=t._id,l=t.likes,j=t.comments;return Object(c.useContext)(w).user,Object(r.jsx)("div",{children:Object(r.jsxs)(b.a,{fluid:!0,children:[Object(r.jsxs)(b.a.Content,{children:[Object(r.jsx)(b.a.Header,{children:o}),Object(r.jsx)(b.a.Meta,{as:i.b,to:"/posts/".concat(s),children:x()(a).fromNow(!0)}),Object(r.jsx)(b.a.Description,{children:n})]}),Object(r.jsx)(b.a.Content,{extra:!0}),Object(r.jsxs)("div",{style:{margin:"20px"},children:[Object(r.jsx)(_,{post:s,likeCount:null===l||void 0===l?void 0:l.length,likes:l}),Object(r.jsx)(v,{content:"Comment on post",children:Object(r.jsxs)(m.a,{labelPosition:"right",as:i.b,to:"/posts/".concat(s),children:[Object(r.jsx)(m.a,{color:"blue",basic:!0,children:Object(r.jsx)(O.a,{name:"comments"})}),Object(r.jsx)(h.a,{basic:!0,color:"blue",pointing:"left",children:null===j||void 0===j?void 0:j.length})]})})]})]})})},Q=n(198),U=n(249),H=n(120),z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(c.useState)(t),r=Object(f.a)(n,2),o=r[0],s=r[1],i=function(e){s(Object(a.a)(Object(a.a)({},o),{},Object(H.a)({},e.target.name,e.target.value)))},l=function(t){t.preventDefault(),e()};return{onChange:i,onSubmit:l,values:o}};function G(){var e=Object(j.a)(["\n  mutation createPost($body: String!) {\n    createPost(body: $body) {\n      _id\n      body\n      createdAt\n      username\n    }\n  }\n"]);return G=function(){return e},e}var B=Object(u.gql)(G()),F=function(){var e=z((function(){s()}),{body:""}),t=e.values,n=e.onChange,a=e.onSubmit,c=Object(u.useMutation)(B,{variables:t,update:function(e,n){var a=e.readQuery({query:D});e.writeQuery({query:D,data:{getPosts:[n.data.createPost].concat(Object(Q.a)(a.getPosts))}}),t.body=""}}),o=Object(f.a)(c,2),s=o[0],i=o[1].error;return Object(r.jsx)(r.Fragment,{children:Object(r.jsxs)(U.a,{onSubmit:a,children:[Object(r.jsx)("h2",{children:"Create a post:"}),Object(r.jsxs)(U.a.Field,{children:[Object(r.jsx)(U.a.Input,{placeholder:"Hi World!",name:"body",onChange:n,value:t.body,error:!!i}),Object(r.jsx)(m.a,{type:"submit",color:"teal",children:"Submit"})]})]})})};function J(){var e=Object(j.a)(["\n  {\n    getPosts {\n      _id\n      body\n      username\n      createdAt\n      likes {\n        _id\n        createdAt\n        username\n      }\n      comments {\n        _id\n        createdAt\n        username\n        body\n      }\n    }\n  }\n"]);return J=function(){return e},e}var V=Object(u.gql)(J()),W=function(){var e=Object(u.useQuery)(V),t=e.loading,n=e.data,a=Object(c.useContext)(w).user;return Object(r.jsx)("div",{children:Object(r.jsxs)(d.a,{columns:1,children:[Object(r.jsx)(d.a.Row,{children:Object(r.jsx)("h2",{style:{padding:"20px"},children:"Recent Posts"})}),a&&Object(r.jsx)(d.a.Column,{children:Object(r.jsx)(F,{})}),Object(r.jsx)(d.a.Row,{children:!t&&(null===n||void 0===n?void 0:n.getPosts)?null===n||void 0===n?void 0:n.getPosts.map((function(e){return Object(r.jsx)(d.a.Column,{style:{marginBotton:"20px"},children:Object(r.jsx)(T,{post:e})},e._id)})):Object(r.jsx)("h1",{children:"loading.."})})]})})};function K(){var e=Object(j.a)(["\n  mutation register($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      _id\n      email\n      username\n      createdAt\n      token\n    }\n  }\n"]);return K=function(){return e},e}var X=Object(u.gql)(K()),Y=function(e){var t=Object(c.useState)(""),n=Object(f.a)(t,2),a=n[0],o=n[1],s=Object(c.useContext)(w).login,i=z((function(){h()}),{username:"",password:""}),l=i.onChange,j=i.onSubmit,d=i.values,b=Object(u.useMutation)(X,{update:function(t,n){s(n.data.login),e.history.push("/")},onError:function(e){o(e.networkError.result.errors[0].message)},variables:d}),O=Object(f.a)(b,2),h=O[0],p=O[1].loading,x=d.username,g=d.password;return Object(r.jsx)("div",{className:"form-container",children:Object(r.jsxs)(U.a,{onSubmit:j,noValidate:!0,className:p?"loading":"",children:[Object(r.jsx)("h1",{children:"Login"}),Object(r.jsx)(U.a.Input,{label:"Username",placeholder:"username..",name:"username",type:"text",value:x,onChange:l}),Object(r.jsx)(U.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:g,onChange:l}),a&&Object(r.jsx)("p",{style:{color:"red"},children:a}),Object(r.jsx)(m.a,{type:"submit",primary:!0,children:"Register"})]})})};function Z(){var e=Object(j.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $confirmPassword: String!\n  ) {\n    register(\n      registerInput: {\n        username: $username\n        email: $email\n        password: $password\n        confirmPassword: $confirmPassword\n      }\n    ) {\n      _id\n      email\n      username\n      createdAt\n      token\n    }\n  }\n"]);return Z=function(){return e},e}var ee=Object(u.gql)(Z()),te=function(e){var t=Object(c.useState)(""),n=Object(f.a)(t,2),a=n[0],o=n[1],s=Object(c.useContext)(w).login,i=z((function(){v()}),{username:"",email:"",password:"",confirmPassword:""}),l=i.onChange,j=i.onSubmit,d=i.values,b=d.username,O=d.email,h=d.password,p=d.confirmPassword,x=Object(u.useMutation)(ee,{update:function(t,n){console.log(n),s(n.data.register),e.history.push("/")},onError:function(e){o(e.networkError.result.errors[0].message)},variables:d}),g=Object(f.a)(x,2),v=g[0],y=g[1].loading;return Object(r.jsx)("div",{className:"form-container",children:Object(r.jsxs)(U.a,{onSubmit:j,noValidate:!0,className:y?"loading":"",children:[Object(r.jsx)("h1",{children:"Register"}),Object(r.jsx)(U.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:b,onChange:l}),Object(r.jsx)(U.a.Input,{label:"Email",placeholder:"Email..",name:"email",type:"email",value:O,onChange:l}),Object(r.jsx)(U.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:h,onChange:l}),Object(r.jsx)(U.a.Input,{label:"Confirm Password",placeholder:"Confirm Password..",name:"confirmPassword",type:"password",value:p,onChange:l}),a&&Object(r.jsx)("p",{style:{color:"red"},children:a}),Object(r.jsx)(m.a,{type:"submit",primary:!0,children:"Register"})]})})},ne=n(250);var ae=function(){var e=Object(c.useContext)(w),t=e.user,n=e.logout,a=window.location.pathname,o="/"===a?"home":a.substr(1),s=Object(c.useState)(o),l=Object(f.a)(s,2),j=l[0],u=l[1],d=function(e,t){var n=t.name;return u(n)};return t?Object(r.jsxs)(ne.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(r.jsx)(ne.a.Item,{name:t.username,active:!0,as:i.b,to:"/"}),Object(r.jsx)(ne.a.Menu,{position:"right",children:Object(r.jsx)(ne.a.Item,{name:"logout",active:"login"===j,onClick:n})})]}):Object(r.jsxs)(ne.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(r.jsx)(ne.a.Item,{name:"home",active:"home"===j,onClick:d,as:i.b,to:"/"}),Object(r.jsxs)(ne.a.Menu,{position:"right",children:[Object(r.jsx)(ne.a.Item,{name:"login",active:"login"===j,onClick:d,as:i.b,to:"/login"}),Object(r.jsx)(ne.a.Item,{name:"register",active:"register"===j,onClick:d,as:i.b,to:"/register"})]})]})},re=n(247),ce=n(199);var oe=function(e){var t=e.component,n=Object(ce.a)(e,["component"]),o=Object(c.useContext)(w).user;return Object(r.jsx)(l.b,Object(a.a)(Object(a.a)({},n),{},{render:function(e){return o?Object(r.jsx)(l.a,{to:"/"}):Object(r.jsx)(t,Object(a.a)({},e))}}))},se=n(197);function ie(){var e=Object(j.a)(["\n  query($postId: ID!) {\n    getPost(postId: $postId) {\n      _id\n      body\n      createdAt\n      username\n      comments {\n        _id\n        body\n        createdAt\n        username\n      }\n      likes {\n        _id\n        username\n        createdAt\n      }\n    }\n  }\n"]);return ie=function(){return e},e}function le(){var e=Object(j.a)(["\n  mutation($postId: String!, $body: String!) {\n    createComment(postId: $postId, body: $body) {\n      _id\n      comments {\n        _id\n        body\n        createdAt\n        username\n      }\n    }\n  }\n"]);return le=function(){return e},e}var je=Object(u.gql)(le()),ue=Object(u.gql)(ie()),de=function(e){var t,n=e.match.params.postId,a=Object(c.useContext)(w).user,o=Object(c.useRef)(null),s=Object(c.useState)(""),i=Object(f.a)(s,2),l=i[0],j=i[1],p=Object(u.useQuery)(ue,{variables:{postId:n}}).data,g=Object(u.useMutation)(je,{update:function(){j(""),o.current.blur()},variables:{postId:n,body:l}}),y=Object(f.a)(g,1)[0];if(null===p||void 0===p?void 0:p.getPost){var I=p.getPost,C=I._id,k=I.body,P=I.createdAt,S=I.username,$=I.comments,A=I.likes;t=Object(r.jsx)(d.a,{children:Object(r.jsxs)(d.a.Row,{children:[Object(r.jsx)(d.a.Column,{width:2,children:Object(r.jsx)(se.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"right"})}),Object(r.jsxs)(d.a.Column,{width:14,children:[Object(r.jsxs)(b.a,{fluid:!0,children:[Object(r.jsxs)(b.a.Content,{children:[Object(r.jsx)(b.a.Header,{children:S}),Object(r.jsx)(b.a.Meta,{children:x()(P).fromNow()}),Object(r.jsx)(b.a.Description,{children:k})]}),Object(r.jsx)("hr",{}),Object(r.jsxs)(b.a.Content,{extra:!0,children:[Object(r.jsx)(_,{post:C,likeCount:A.length,likes:A}),Object(r.jsx)(v,{content:"Comment on post",children:Object(r.jsxs)(m.a,{as:"div",labelPosition:"right",onClick:function(){return a?" ":alert("please signin")},children:[Object(r.jsx)(m.a,{basic:!0,color:"blue",children:Object(r.jsx)(O.a,{name:"comments"})}),Object(r.jsx)(h.a,{basic:!0,color:"blue",pointing:"left",children:$.length})]})})]})]}),a&&Object(r.jsx)(b.a,{fluid:!0,children:Object(r.jsxs)(b.a.Content,{children:[Object(r.jsx)("p",{children:"Post a comment"}),Object(r.jsx)(U.a,{children:Object(r.jsxs)("div",{className:"ui action input fluid",children:[Object(r.jsx)("input",{type:"text",placeholder:"Comment..",name:"comment",value:l,onChange:function(e){return j(e.target.value)},ref:o}),Object(r.jsx)("button",{type:"submit",className:"ui button teal",disabled:""===l.trim(),onClick:y,children:"Submit"})]})})]})}),null===$||void 0===$?void 0:$.map((function(e){return Object(r.jsx)(b.a,{fluid:!0,children:Object(r.jsxs)(b.a.Content,{children:[a&&a.username===e.username&&Object(r.jsx)(L,{postId:C,commentId:e._id}),Object(r.jsx)(b.a.Header,{children:e.username}),Object(r.jsx)(b.a.Meta,{children:x()(e.createdAt).fromNow()}),Object(r.jsx)(b.a.Description,{children:e.body})]})},e._id)}))]})]})})}else t=Object(r.jsx)("p",{children:"Loading post.."});return t};var be=function(){return Object(r.jsx)(P,{children:Object(r.jsx)(i.a,{children:Object(r.jsxs)(re.a,{children:[Object(r.jsx)(ae,{}),Object(r.jsxs)(l.d,{children:[Object(r.jsx)(l.b,{exact:!0,path:"/",component:W}),Object(r.jsx)(oe,{exact:!0,path:"/login",component:Y}),Object(r.jsx)(oe,{exact:!0,path:"/register",component:te}),Object(r.jsx)(l.b,{exact:!0,path:"/posts/:postId",component:de})]})]})})})},me=n(196),Oe=Object(u.createHttpLink)({uri:"https://merng-chat-app1.herokuapp.com/graphql"}),he=Object(me.a)((function(e,t){var n=t.headers,r=localStorage.getItem("jwtToken");return{headers:Object(a.a)(Object(a.a)({},n),{},{authorization:r?"Bearer ".concat(r):""})}})),pe=new u.ApolloClient({link:he.concat(Oe),cache:new u.InMemoryCache});s.a.render(Object(r.jsx)(u.ApolloProvider,{client:pe,children:Object(r.jsx)(be,{})}),document.getElementById("root"))}},[[230,1,2]]]);
//# sourceMappingURL=main.2f246a25.chunk.js.map